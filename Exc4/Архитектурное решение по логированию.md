# Логирование

## Сбор логов: откуда собираем и что 

На схеме отображены системы, с которых требуется сбор логов:

![c4](resources/jewerly_c4_jewerly_c4_withlogs.png)


* создание нового заказа (id, время, новый статус, пользователь, создавший заказ, детали заказа)
* изменение статуса заказа (id, время, новый статус)
* начало расчета стоимости (id заказа, время)
* окончание расчета стоимости (id заказа, время)
* обновление данных пользователя (id пользователя, время, измененные данные)
* поступление платежа (id транзакции, последние 4 цифры карты, способ оплаты, id заказа, время)
* ошибки при работе систем shop API, MES API, CRM API (время, текст ошибки, информация для локализации ошибки: stacktrace, имя класса и функции)

БД:
* ошибки (текст запроса, информация о пользователе, имя БД, текст ошибки)
* неудачные соединения (логин, имя БД, IP-адрес, время попытки)
* длительные запросы, превышающие установленный порог (текст запроса, информация о пользователе, имя БД, время выполнения)
* изменения структуры БД (время изменения, инициатор, тип изменения)

Message Broker:
* неуспешные попытки доставки сообщений (причина ошибки, идентификатор сообщения, имя очереди)
* изменения конфигурации очередей (тип изменения, время, инициатор, имя очереди)

Уровень DEBUG будем использовать в случаях, когда требуется подробный лог. Например, во время разработки или при отладке сложных и редких проблем на продакшене. 


## Мотивация

Логирование предоставляет подробную информацию о работе системы в реальном времени. Это базовый инструмент для диагностики, анализа и мониторинга, позволяющий получать информацию о состоянии системы, её компонентах и взаимодействиях.

Внедрив логирование, мы сможем:

* Сделать систему стабильнее, анализируя логи и исправляя ошибки в системе
* Оперативно устранять сбои, фиксируя критические ошибки и их причины
* Получать данные для аудита, таких как изменения в заказах, платежах и конфигурациях системы
* Анализировать поведение системы, выявлять узкие места
* При получении сведений об ошибке от клиентов, сможем проанализировать его проблему